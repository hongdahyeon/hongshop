<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/default}">

<th:block layout:fragment="head">
    <title>HONG SHOP</title>
    <style>
        .nav-link {
            margin-top: 10px; /* Adjust the margin-top value as needed */
        }
    </style>
</th:block>

<th:block layout:fragment="content">
    <div class="mt-3">
        <div class="card-header" style="margin-bottom: 10px">
            <div class="card-text d-flex justify-content-between">
                <div class="text-start">
                    <h3 id="category-name">ÏµúÏã†ÏÉÅÌíà</h3>
                </div>
                <div class="text-end"></div>
            </div>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-3">
                    <!-- Vertical tabs -->
                    <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                        <a class="nav-link active nav-category-link" id="newProdcuts-tab" data-bs-toggle="tab" href="#newProdcuts" role="tab" aria-controls="newProdcuts" aria-selected="true">ÏµúÏã†ÏÉÅÌíà</a>
                        <a th:each="cat, catStaa: ${categories}" class="nav-link nav-category-link"  data-bs-toggle="tab" role="tab" aria-selected="false" th:id="|product-${cat.categoryId}-tab|" th:href="'#product'+${cat.categoryId}" th:aria-controls="|product${cat.categoryId}|" th:text="${cat.categoryName}"></a>
                    </div>
                </div>
                <div class="col-md-9">
                    <!-- Tab content -->
                    <div class="tab-content" id="tab-content">

                        <!-- s: newProdcuts-tab -->
                        <div class="tab-pane fade show active" id="newProdcuts" role="tabpanel" aria-labelledby="newProdcuts-tab">

                            <div class="image-grid">
                                <div class="image-item" th:each="product, productStat : ${newProdcuts}">
                                    <button class="btn img-btn" type="button" th:id="|btn-${product.productId}|" th:data-num="${product.productId}" th:data-stock="${product.productStock}">
                                        <img th:src="'/image?imageId=' + ${product.getFile().getFileList().get(0).getSavedFileName()}" class="rounded" alt="Image" style="width: 150px; height: 150px">
                                    </button>
                                    <div class="product-info">
                                        <p class="image-name">
                                            <span th:text="${product.productName}"></span>
                                            <i data-feather="star" class="font-medium-2 ms-50"></i>
                                        </p>
                                        <p th:text="|Í∞ÄÍ≤©: ${product.productPrice}|" class="image-name"></p>
                                    </div>
                                </div>
                            </div>

                        </div>
                        <!-- e: newProdcuts-tab -->


                        <th:block th:each="cat, catStat : ${categories}">
                            <!-- s -->
                            <div class="tab-pane fade" th:id="|product${cat.categoryId}|" role="tabpanel" th:aria-labelledby="|product-${cat.categoryId}-tab|">
                                <div class="image-grid">
                                    <div class="image-item" th:each="product, productStat : ${cat.productList}">
                                        <button class="btn img-btn" type="button" th:id="|btn-${product.productId}|" th:data-num="${product.productId}" th:data-stock="${product.productStock}">
                                            <th:block th:if="${product.getFile() != null}">
                                                <img th:src="'/image?imageId=' + ${product.getFile().getFileList().get(0).getSavedFileName()}" class="rounded" alt="Image" style="width: 150px; height: 150px">
                                            </th:block>
                                            <th:block th:unless="${product.getFile() != null}">
                                                <img src="/assets/src/shop/noImage.png" class="rounded" alt="Image" style="width: 150px; height: 150px">
                                            </th:block>
                                        </button>
                                        <div class="product-info">
                                            <p class="image-name">
                                                <span th:text="${product.productName}"></span>
                                                <i th:if="${product.newProductYn == 'Y'}" data-feather="star" class="font-medium-2 ms-50"></i>
                                            </p>
                                            <p th:text="|Í∞ÄÍ≤©: ${product.productPrice}|" class="image-name"></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- e -->
                        </th:block>
                    </div>
                </div>
            </div>
        </div>

        <!-- s: Alert Modal -->
        <div class="modal fade" id="alertModal" tabindex="-1" aria-labelledby="alertModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-body">
                        <div class="card-body">
                            <p>Ìï¥Îãπ ÏÉÅÌíàÏùÄ ÌòÑÏû¨ Ïû¨Í≥†Í∞Ä ÏóÜÏñ¥ÏÑú Íµ¨ÏûÖÏù¥ Î∂àÍ∞ÄÎä•Ìï©ÎãàÎã§.</p>
                            <p>Ìï¥Îãπ Î¨ºÌíà Íµ¨ÏûÖÏùÑ ÏõêÌïòÏã†Îã§Î©¥ Î¨∏ÏùòÍ∏ÄÏùÑ ÎÇ®Í≤®Ï£ºÏÑ∏Ïöî.</p>
                            <div style="margin-top: 10px" class="text-end">
                                <button type="button" class="btn btn-outline-secondary" id="close-alertModal">Îã´Í∏∞</button>
                                <button type="button" class="btn btn-outline-primary" id="goto-qna-post">Î¨∏ÏùòÍ∏Ä ÏûëÏÑ±ÌïòÎü¨Í∞ÄÍ∏∞</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- e: Alert Modal -->

        <!-- s: Product Purchase Modal -->
        <form id="product-purchase-form" class="needs-validation" novalidate>
            <div class="modal fade" id="product-purchase-modal" tabindex="-1" aria-labelledby="productModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">

                        <!-- Modal Header -->
                        <div class="modal-header">
                            <h4 class="modal-title">Ï£ºÎ¨∏ÌïòÍ∏∞</h4>
                            <button type="button" class="btn-close" id="close-product-purchase-modal-btn"></button>
                        </div>

                        <div class="modal-body">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-12 col-12" style="margin-bottom: 10px; align-content: center">
<!--                                        <div class="image-grid">-->
<!--                                            <div class="image-item">-->
<!--                                               -->

<!--                                                <div class="product-info">-->
<!--                                                    <p class="image-name">-->
<!--                                                        <span id="product-name">Îπµ</span>-->
<!--                                                        <i data-feather="star" class="font-medium-2 ms-50" disabled id="product-new-yn"></i>-->
<!--                                                    </p>-->
<!--                                                    <p id="product-price" class="image-name">Í∞ÄÍ≤©: 2,000</p>-->
<!--                                                    <p id="product-cnt" class="image-name">Ïû¨Í≥†: 3Í∞ú</p>-->
<!--                                                </div>-->
<!--                                            </div>-->
<!--                                        </div>-->
                                        <div class="product-container">
                                            <img src="/assets/src/shop/noImage.png" class="rounded" alt="Image" style="width: 150px; height: 150px" id="product-img">
                                            <div class="product-name">Product Name</div>
                                            <div class="product-price">$19.99</div>
                                            <div class="product-stock">In Stock</div>
                                        </div>
                                    </div>
                                    <div class="col-md-6 col-12">
                                        <div class="mb-1">
                                            <label class="form-label" for="hongCategoryId">Ïπ¥ÌÖåÍ≥†Î¶¨ ÏàúÏÑú<span class="text-primary ms-50">*</span></label>
                                            <div class="input_wrap">
                                                <input type="text" class="form-control" id="orderNum" name="orderNum" required/>
                                                <div class="invalid-feedback">Ïπ¥ÌÖåÍ≥†Î¶¨ ÏàúÏÑúÎ•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-12 col-12">
                                        <div class="mb-1 margin-10">
                                            <label class="form-label" for="hongCategoryId">Ïπ¥ÌÖåÍ≥†Î¶¨ ID<span class="text-primary ms-50">*</span></label>
                                            <div class="input_wrap">
                                                <input type="text" class="form-control" id="hongCategoryId" name="hongCategoryId" disabled/>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-12 col-12">
                                        <div class="mb-1 margin-10">
                                            <label class="form-label" for="description">ÏÑ§Î™Ö<span class="text-primary ms-50">*</span></label>
                                            <textarea class="form-control" id="description" name="description" required></textarea>
                                            <div class="invalid-feedback">Ïπ¥ÌÖåÍ≥†Î¶¨Ïóê ÎåÄÌïú ÏÑ§Î™ÖÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.</div>
                                        </div>
                                    </div>
                                </div>
                                <div style="margin-top: 10px" class="text-end">
                                    <button type="button" class="btn btn-outline-secondary" id="close-productModal">Îã´Í∏∞</button>
                                    <button type="submit" class="btn btn-outline-primary" id="into-purchase">üéÅÏ£ºÎ¨∏ÌïòÍ∏∞</button>
                                    <button type="submit" class="btn btn-outline-success" id="into-chart">üõíÏû•Î∞îÍµ¨ÎãàÎã¥Í∏∞</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </form>
        <!-- e: Product Purchase Modal -->
    </div>
</th:block>


<th:block layout:fragment="script">
    <script th:inline="javascript">
        const newProdcuts = /*[[${newProdcuts}]]*/[]
        const categories = /*[[${categories}]]*/{}
        const qnaPost = /*[[${qnaPost}]]*/{}

        $(document).ready(function(e){
            feather.replace()
        })

        /* Ïπ¥ÌÖåÍ≥†Î¶¨ nav ÌÅ¥Î¶≠Ïóê Îî∞Î•∏ text Î≥ÄÍ≤Ω */
        $(".nav-category-link").on("click", function(e){
            const categoryName = $(this).text();
            $("#category-name").text(categoryName)
        })

        /* ÏÉÅÌíàÍµ¨Îß§ Î™®Îã¨Ï∞Ω Îã´Í∏∞ */
        $("#close-productModal, #close-product-purchase-modal-btn").on("click", function(e){
            // validation ÏßÄÏö∞Í∏∞
            const form = document.getElementById("product-purchase-form")
            form.classList.remove("was-validated")
            $("#product-purchase-modal").modal('hide')
        })

        /* alertModal Î™®Îã¨Ï∞Ω Îã´Í∏∞ */
        $("#close-alertModal").on("click", function(e){
            $("#alertModal").modal('hide')
        })

        /* alertModal -> [Î¨∏ÏùòÍ∏Ä ÏûëÏÑ±ÌïòÎü¨Í∞ÄÍ∏∞] Î≤ÑÌäº ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ */
        $("#goto-qna-post").on("click", function(e){
            if(qnaPost) window.location.href = `/bbs/${qnaPost['postTypeId']}`
            else {
                alert("Ï£ÑÏÜ°Ìï©ÎãàÎã§." + '\n' + "ÏïÑÏßÅ ÏßàÏùòÏùëÎãµ Í≤åÏãúÌåêÏù¥ ÏóÜÏäµÎãàÎã§." + '\n' + "Ïû†ÏãúÎßå Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî.")
                $("#alertModal").modal('hide')
            }
        })

        /* Ïù¥ÎØ∏ÏßÄ Î≤ÑÌäº ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ */
        $(".img-btn").on("click", function(e){
            const productId = $(this).attr("data-num")
            const productStock = $(this).attr("data-stock")
            console.log("productId : ", productId)
            console.log("productStock : ", productStock)

            if(productStock == 0) $("#alertModal").modal('show')
            else $("#product-purchase-modal").modal('show')
        })

        /* ÏÉÅÌíà Íµ¨Îß§ÌïòÍ∏∞ form */
        window.addEventListener("load", function() {
            const form = document.getElementById("product-purchase-form")
            form.addEventListener("submit", function(event) {
                if (form.checkValidity() === false) {
                    event.preventDefault();
                    form.classList.add("was-validated")
                } else {
                    event.preventDefault();

                    FormDataToObj.getParameter("product-purchase-form").then((obj) => {
                        console.log("obj : ", obj)
                    })
                }
            })
        })
    </script>
</th:block>

</html>